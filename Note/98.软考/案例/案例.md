# 软件架构设计
| 案例题号 | 试题类型 | 考查内容 | 知识点 |
|----------|----------|----------|--------|
| 试题1 | 必答题 | 软件架构设计 | `每年必考1-2题`。主考考查质量属性、软件架构风格、软件架构评估、`MVC架构`、面向服务的架构`SOA`、`ESB架构`、`J2EE架构` |
| 试题2-试题5 | 选答题，四选二 | 软件系统设计 | `几乎每年必考1题`。主考考查`UML`的图、关系，尤其是类图、用例图、顺序图、活动图和状态图；`设计模式`；数据流图、`E-R图`；项目管理-进度管理-关键路径 |
|  |  | 数据库系统设计 | `几乎每年必考1题`。主考考查数据库的一些新技术的比较，如`关系型数据库`、`非关系型数据库NoSQL`以及`内存数据库Redis`等，还会包括`反规范化技术`、`主从复制`、`负载均衡`等 |
|  |  | 嵌入式系统设计 | `几乎每年必考1题`。主要考查`嵌入式系统`的实时性和可靠性以及容错性等概念。大概率会考到一些`嵌入式领域陌生技术`，如果是完全没见过的技术，不选即可 |
|  |  | Web系统设计 | `几乎每年必考1题`。主要考查`Web相关技术`，一般结合`架构`进行考查。偶尔会考到新技术，遇到完全没听说过的技术，就不选 |
|  |  | 第二版教材八大架构 | 信息系统架构设计、层次式架构设计、云原生架构设计、面向服务架构设计、嵌入式系统架构设计、通信系统架构设计、安全架构设计、大数据架构设计 |



## 质量效用树
在架构评估过程中，所普遍关注的质量属性有以下几种。

（1）性能：指系统的响应能力，即要经过多长时间才能对某个事件做出响应，或者在某段时间内系统所能处理的事件的个数。如`响应时间、吞吐量`。
设计策略：`优先级队列、增加计算资源、减少计算开销、引入并发机制、采用资源调度等`。

（2）可靠性：是软件系统在应用或系统错误面前，在`意外或错误使用的情况下维持软件系统的功能特性的基本能力`。可靠性通常用平均失效等待时间（Mean Time To Failure，MTTF）和平均失效间隔时间（Mean Time Between Failure，MTBF）来衡量。在失效率为常数和修复时间很短的情况下，MTTF 和 MTBF几乎相等。可分为容错和健壮性。容错是指在错误发生时确保系统正确的行为，并进行内部“修复”。健壮性是指系统不受错误使用和错误输入的影响，按既定程序忽略错误。

设计策略：`冗余、心跳、选举、Ping/Echo`。

（3）可用性：是系统能够正常运行的时间比例，经常用两次故障之间的时间长度或在出现故障时系统能够恢复正常的速度来表示。如故障间隔时间。设计策略：`冗余、心跳、选举、Ping/Echo`。

（4）安全性：是指`系统在向合法用户提供服务的同时能够阻止非授权用户使用的企图或拒绝服务的能力`。可分为`机密性、完整性、不可否认性、可控性`。
* 机密性保证信息不泄露给未授权的用户、实体或过程；
* 完整性保证信息的完整和准确，防止信息被非法修改；
* 不可否认性是指信息交换的双方不能否认其在交换过程中发送信息或接收信息的行为；
* 可控性保证对信息的传播及内容具有控制的能力，防止为非法者所用。

设计策略：入侵检测、用户认证、用户授权、追踪审计。


（5）可修改性：指能够快速的以较高的性能价格比对系统进行变更的能力。通常以某些具体的变更为基准，通过考虑这些变更的代价来衡量可修改性。可分为可维护性、可扩展性、结构重组和可移植性。
    * 可维护性：在错误发生后“修复”软件系统的难易程度。
    * 可扩展性：软件因适应新需求或需求变化而增加新功能的能力。
    * 结构重组：重新组织软件系统的构件及构件之间的关系。
    * 可移植性：将软件系统从一个运行环境转移到另一个不同的运行环境的难易程度。

    设计策略：接口-实现分类、抽象、信息隐藏。

（6）**功能性**：是系统所能完成所期望的工作的能力。一项任务的完成需要系统中许多或大多数构件的相互协作。

（7）**可变性**：指架构经扩充或变更而成为新架构的能力。这种新架构应该符合预先定义的规则，在某些具体方面不同于原有的架构。当要将某个架构作为一系列相关产品的基础时，可变性是很重要的。

（8）**互操作性**：作为系统组成部分的软件不是独立存在的，通常与其他系统或自身环境相互作用。为了支持互操作性，软件架构必须为外部可视的功能特性和数据结构提供精心设计的软件入口。程序和用其他编程语言编写的软件系统的交互作用就是互操作性的问题，这种互操作性问题也影响应用的软件架构。





## 软件质量属性
在软件架构评估（特别是ATAM方法）中，最核心的质量特性通常被称为 **“四大质量属性”**。它们是利益相关者最关心的，也是架构权衡分析的重点。

以下是这四大核心质量特性及其重要的**子特性**的详细说明：

---

### **1. 性能**
指系统的响应能力和吞吐效率。

**核心度量：** 响应时间、吞吐量、延迟
**主要子特性/关注点：**
*   **响应时间**：系统对事件做出反应所需的时间。
*   **吞吐量**：单位时间内系统能处理的事件或事务数量。
*   **资源利用率**：CPU、内存、网络等资源的使用效率。
*   **并发性**：系统同时处理多个请求的能力。
*   **设计策略示例**：优先级队列、增加资源、减少计算开销、引入并发、资源调度。

---

### **2. 可靠性**
指系统在出现故障或异常情况下，维持其功能的能力。

**核心度量：** 平均失效间隔时间（MTBF）、平均失效前时间（MTTF）
**主要子特性：**
*   **容错性**：在发生错误时，系统能够检测、隔离并恢复，确保服务不中断或数据不丢失（内部修复）。
*   **健壮性**：系统能够抵御错误的输入、非法的操作或意外使用，而不会崩溃或产生严重后果（忽略或优雅处理错误）。
*   **设计策略示例**：冗余（硬件/软件）、心跳检测、领导者选举、Ping/Echo。

---

### **3. 可用性**
指系统能够提供服务的时间比例，即可用时长。

**核心度量：** 可用性百分比（如99.99%）、平均修复时间（MTTR）
**说明**：可用性与可靠性紧密相关但侧重点不同。**可靠性关注“别出故障”**（故障间隔），**可用性关注“坏了能快速恢复”**（故障修复速度）。
*   **例如**：一个系统一年故障1次，但修复需要1天（可靠性高，可用性尚可）；另一个系统每月故障1次，但每次修复只需1分钟（可靠性低，但可用性极高）。
*   **设计策略示例**：冗余、故障转移、热切换、回滚机制。策略常与可靠性共享（如冗余、心跳）。

---

### **4. 安全性**
指系统保护信息和资源，防止未授权访问和使用的能力。

**核心度量**：安全漏洞数量、攻击抵抗成功率
**主要子特性（安全四大基石）：**
*   **机密性**：防止信息泄露给未授权实体。**（保密）**
*   **完整性**：防止信息被未授权篡改或破坏。**（防篡改）**
*   **不可否认性**：确保操作者无法否认其行为。**（防抵赖）**
*   **可控性**：能够控制信息的传播和访问。**（可管控）**
*   **设计策略示例**：身份认证、访问授权、加密、入侵检测、安全审计日志。

---

### **其他重要质量属性（在效用树中常一并考虑）**

#### **5. 可修改性**
指系统能够以较小成本和风险进行变更的难易程度。

**主要子特性：**
*   **可维护性**：修复现有缺陷的难易程度。
*   **可扩展性**：增加新功能的难易程度。
*   **结构可重组性**：调整组件结构的灵活性。
*   **可移植性**：迁移到新环境的难易程度。
*   **设计策略示例**：模块化、信息隐藏、接口与实现分离、使用抽象层。

#### **6. 功能性**
系统完成其预定任务和提供所需服务的能力。这是基本要求，但在架构权衡中，有时需要为了其他质量属性（如性能、安全性）而调整功能性的实现方式。

#### **7. 互操作性**
系统与其他外部系统或组件顺畅交互和协作的能力。

### **总结与关系**

在架构设计中，这些质量属性**经常相互冲突**，需要进行**权衡**：
*   提升**安全性**（如增加加密）可能会降低**性能**。
*   提高**可靠性/可用性**（通过冗余）可能会增加成本并影响**可修改性**。
*   过度优化**性能**（如深度耦合）可能会损害**可修改性**和**可移植性**。

**ATAM方法中的效用树**，正是通过 `(重要性， 难度)` 的方式，对这些属性及其具体场景进行**优先级排序**，帮助架构师识别最关键的需求，并做出明智的权衡决策。











### 质量属性效用树
ATAM方法采用`效用树` (Utility tree) 这一工具来对质量属性进行分类和优先级排序。`效树的结构包括树根——质量属性——属性——质量属性场景（叶子节点）`。需要注意的是，ATAM主要关注4类质量属性：`性能、安全性、可修改性和可用性`，因为这是利益相关者最为关心的，有具体来对质量属性进行分类。


```plaintext
效用树根
└── 核心质量属性
    ├── 性能 (Performance)
    │   ├── [数据延迟]
    │   │   ├── (M,L) 把客户数据库的存储延迟减到最小值(200ms)
    │   │   └── (H,M) 提供实时视频图像
    │   └── [交易吞吐量]
    │       └── (M,M) 使认证服务器的平均吞吐量最大化
    ├── 安全性 (Security)
    │   └── [数据机密性]
    │   │   ├── (L,H) 信用卡交易在99.999%的时间内是安全的
    │   │   └── (L,H) 客户数据库认证在99.999%的时间内能正常工作
    │   └── [数据完整性]
    ├── 可修改性 (Modifiability)
    │   ├── [新产品目录]
    │   └── [商业产品改变]
    │       ├── (L,H) 以小于20人月的工作量添加CORBA中间件
    │       └── (H,L) 以小于4人周的工作量更改Web用户界面
    └── 可用性 (Availability)
        ├── [硬件故障]
        │   ├── (L,H) 若站点1断电，要求在3秒内将任务重定向到站点3
        │   ├── (M,M) 若磁盘出现故障，要在5分钟内重新启动
        │   └── (H,M) 要在1.5分钟内检测并恢复网络故障
        └── [商业软件故障]
```



## 八大经典软件架构风格
八大经典软件架构风格是软件工程中经过长期实践总结出的、具有**特定设计思想、结构模式和适用场景**的架构范式。它们是构建复杂系统的基础模板。

以下是这八大架构风格的详细说明：

---

### 1. **分层架构**
*   **核心思想**：将系统按职责垂直划分为若干层，每层为其上层提供服务，并调用下层的服务。通常遵循“单向依赖”原则（上层依赖下层）。
*   **常见分层**：表现层（UI）、业务逻辑层（BLL）、数据访问层（DAL）。
*   **优点**：关注点分离、高内聚低耦合、易于维护和测试、技术栈可分层变化。
*   **缺点**：性能可能有损耗（层层调用）、过度的分层会导致复杂度增加。
*   **典型应用**：企业级应用（如ERP、CRM）、传统Web应用。

### 2. **客户端-服务器架构**
*   **核心思想**：资源或服务由**服务器**集中管理和提供，多个**客户端**通过网络向服务器发起请求并获取服务。
*   **关键特征**：中心化、请求/响应模式、服务器是瓶颈和单点。
*   **变体**：两层C/S、三层C/S、多层C/S。
*   **优点**：数据集中管理、安全性高、客户端可以“瘦身”。
*   **缺点**：服务器容易成为性能瓶颈和单点故障点、网络依赖强、升级维护成本高。
*   **典型应用**：数据库系统、电子邮件、银行交易系统。

### 3. **管道-过滤器架构**
*   **核心思想**：将系统的数据处理过程分解为一系列独立的**过滤器**，每个过滤器完成特定的数据变换。过滤器之间通过**管道**连接，数据流像在流水线上一样被依次处理。
*   **关键特征**：数据流驱动、组件（过滤器）独立、重用性强。
*   **优点**：高内聚、松耦合、易于扩展（添加新过滤器）、支持并发执行。
*   **缺点**：不适合交互式应用、过滤器间共享状态困难、数据传输开销可能大。
*   **典型应用**：编译器（词法分析→语法分析→语义分析→代码生成）、日志处理、图像处理流水线。

### 4. **事件驱动架构**
*   **核心思想**：系统的行为由**事件**的发布、传播和消费来驱动。组件间通过事件进行异步通信，彼此不直接依赖。
*   **关键特征**：异步、解耦、事件总线/代理、发布-订阅模式。
*   **优点**：极高的响应性和可扩展性、组件间高度解耦、适应复杂不确定的业务流。
*   **缺点**：复杂性高、事件流难以跟踪和调试、数据一致性保障难（最终一致性）。
*   **典型应用**：图形用户界面（GUI）、实时数据处理系统、微服务间的集成。

### 5. **微内核架构**
*   **核心思想**：又称插件化架构。系统有一个**最小核心**，只负责核心功能和插件的生命周期管理。其他所有功能都作为**插件**动态添加到内核之外。
*   **关键特征**：内核小巧稳定、插件可热插拔、功能可扩展。
*   **优点**：极高的灵活性和可扩展性、内核与插件隔离性好、易于定制。
*   **缺点**：内核设计难度大、插件间通信可能复杂、性能开销。
*   **典型应用**：操作系统（如Mach）、集成开发环境（如Eclipse）、浏览器、大型商业软件平台。

### 6. **仓库架构**
*   **核心思想**：系统围绕一个**中央数据结构**（仓库，如数据库、知识库）进行组织。多个**独立组件**（如处理器、视图）访问和操作这个共享仓库。
*   **关键特征**：数据集中存储、组件通过仓库间接交互、数据驱动。
*   **变体**：
    *   **数据库为中心**：组件通过数据库交换数据。
    *   **黑板系统**：组件协作求解复杂问题，数据状态变化触发组件执行。
*   **优点**：数据集中管理、组件松耦合、易于添加新组件（新视图或处理器）。
*   **缺点**：仓库可能成为瓶颈和单点故障、数据一致性管理复杂。
*   **典型应用**：集成开发环境、语音/图像识别系统、决策支持系统。

### 7. **面向服务的架构**
*   **核心思想**：将应用功能封装成一组**松散耦合、可复用、自包含的“服务”**。服务之间通过定义良好的、标准化的接口和协议（通常是网络协议，如HTTP/SOAP/REST）进行通信。
*   **关键特征**：服务自治、标准化接口、松散耦合、可发现性。
*   **优点**：高重用性、跨平台集成能力强、易于业务重组和演化。
*   **缺点**：服务间网络通信带来延迟和可靠性问题、服务治理复杂（发现、监控、安全）、分布式事务困难。
*   **典型应用**：企业应用集成（EAI）、跨部门/跨企业的业务流程、**微服务架构的前身和理论基础**。

### 8. **解释器架构**
*   **核心思想**：设计一个**解释器引擎**来解释执行用户或程序定义的**脚本、规则或领域特定语言**。通常包括一个执行引擎和一套自定义的语法规则。
*   **关键特征**：有自定义的语言或规则集、有解析和执行该语言/规则的引擎。
*   **优点**：极高的灵活性和动态性、易于实现用户自定义逻辑、业务规则外置。
*   **缺点**：性能较低、解释器引擎设计复杂、难以调试。
*   **典型应用**：规则引擎（如Drools）、脚本引擎（如游戏中的任务脚本）、领域特定语言（DSL）处理器。

---

### **总结与对比表**

| 架构风格 | 核心组织原则 | 适用场景 | 关键质量属性倾向 |
| :--- | :--- | :--- | :--- |
| **分层架构** | 职责分层，单向依赖 | 企业级应用，传统Web应用 | **可修改性**、可维护性 |
| **客户端-服务器** | 服务集中，请求/响应 | 数据库，集中式管理应用 | **安全性**、数据一致性 |
| **管道-过滤器** | 数据流，处理流水线 | 编译器，批处理系统 | **可重用性**、可扩展性 |
| **事件驱动架构** | 事件发布与订阅，异步通信 | GUI，实时监控，复杂事件处理 | **可扩展性**、响应性、**松耦合** |
| **微内核架构** | 核心+插件，功能扩展 | IDE，操作系统，可扩展平台 | **可扩展性**、可定制性 |
| **仓库架构** | 中央数据存储，组件环绕 | 集成开发环境，AI系统（黑板） | **数据集中管理**、组件独立性 |
| **面向服务架构** | 松散耦合，标准化服务 | 企业集成，跨系统业务流程 | **互操作性**、可重用性 |
| **解释器架构** | 自定义语言/规则解释执行 | 规则引擎，脚本系统，DSL | **灵活性**、可配置性 |

**注意**：在实际项目中，常常是多种架构风格的**混合使用**。例如，一个基于**微服务**（SOA的演进）的系统，其单个服务内部可能采用**分层架构**，服务间采用**事件驱动**进行通信。架构师的任务是根据业务需求、质量属性和约束，选择和组合最合适的架构风格。
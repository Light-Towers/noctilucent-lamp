## 锁提前释放

* 设置锁的过期时间短于业务知行时间
* 释放了别人的锁
  * 现象：
    * 代码层面：A线程拿到锁，由于业务执行逻辑过长，锁超时释放，B线程拿到锁。此时A线程走到释放锁的逻辑。
    * redis集群层面：A线程加锁，此时master节点挂掉(锁数据还未同步至slave)，新master没有锁记录，B线程拿到锁。此时A线程走到释放锁的逻辑。
  * 解决方法：释放锁时需要判断是否是同一个线程



## 锁未释放

* 锁未设置超时时间
* 锁和过期 未使用原子命令
* 未加finally代码块释放锁
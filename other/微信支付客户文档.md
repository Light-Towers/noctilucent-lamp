# 微信支付客户文档

> 文档版本：微信支付开发文档V3
> 编写日期：2025-09-16

## 目录
- [微信支付客户文档](#微信支付客户文档)
  - [目录](#目录)
  - [1. 必要参数说明](#1-必要参数说明)
  - [2. 商户API证书申请与管理](#2-商户api证书申请与管理)
    - [2.1 获取商户API证书](#21-获取商户api证书)
    - [2.2 常见问题](#22-常见问题)
      - [2.2.1 如何查看商户API证书序列号？](#221-如何查看商户api证书序列号)
      - [2.2.2 如何获取商户API证书私钥？](#222-如何获取商户api证书私钥)
      - [2.2.3 如何查看商户API证书使用量？](#223-如何查看商户api证书使用量)
      - [2.2.4 在商户API证书即将到期时，如果旧证书未申请作废，是否可以在证书到期后直接使用新申请的证书？](#224-在商户api证书即将到期时如果旧证书未申请作废是否可以在证书到期后直接使用新申请的证书)
  - [3. 微信支付公钥获取](#3-微信支付公钥获取)
  - [4. APIv3密钥设置流程](#4-apiv3密钥设置流程)
  - [5. JSAPI(微信内部浏览器支付) 前置配置](#5-jsapi微信内部浏览器支付-前置配置)
    - [5.1 APPID与商户号(mchid)绑定](#51-appid与商户号mchid绑定)
    - [5.2 申请JSAPI支付产品权限](#52-申请jsapi支付产品权限)
    - [5.3 核实JSAPI支付权限开通结果](#53-核实jsapi支付权限开通结果)
    - [5.4 配置JSAPI支付授权目录](#54-配置jsapi支付授权目录)
  - [参考链接](#参考链接)

---

## 1. 必要参数说明

| **参数名**                                                   | **用途**                                                     | **获取角色**                                                 | **获取方式**                                                 |
| :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **mchid**                                                    | `mchid`(商户号)是商户在[商户平台](https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F)申请的唯一身份标识，所有接口在调用时都必须传入商户号，微信支付通过商户号确认商户身份。 | 超级管理员、[技术负责人](https://pay.weixin.qq.com/doc/v3/merchant/4015423618) | 登录微信商户平台，点击【账户中心 -> 商户信息】即可查看。     |
| **appid**                                                    | `appid`(开发者ID)是商户在微信[开放平台](https://open.weixin.qq.com/)(移动应用)或[公众平台](https://mp.weixin.qq.com/)(服务号/政府或媒体类型的公众号/小程序)上的账号开发识别码，该`appid`必须与商户号`mchid`进行绑定。 | 超级管理员、技术负责人                                       | 登录微信商户平台，可查看商户号已绑定的appid。若未绑定，请超级管理员参考[商户号绑定appid指南](https://pay.weixin.qq.com/doc/v3/merchant/4013287010#2%E3%80%81%E5%95%86%E6%88%B7%E5%8F%B7%E7%BB%91%E5%AE%9A%E6%96%B0%E7%9A%84APPID%E8%B4%A6%E5%8F%B7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97)。 |
| **商户API证书**                                              | 商户发起APIv3接口请求时，需要使用商户API证书私钥对请求进行签名。 | 超级管理员、技术负责人                                       | 首次获取请登录微信商户平台，参考[申请商户API证书流程](https://pay.weixin.qq.com/doc/v3/merchant/4013053053)进行下载。下载后请妥善保管，该证书只能下载一次，若遗失或泄露，需在商户平台重新申请。 |
| **商户API证书序列号**                                        | 调用APIv3接口时请求头中的必传参数(`serial_no`)，需要与生成签名值时使用的商户API证书对应。 | 超级管理员、技术负责人                                       | 登录微信商户平台或通过证书解析工具可获取，详见[查看商户API证书序列号指南](https://pay.weixin.qq.com/doc/v3/merchant/4013053053#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%95%86%E6%88%B7API%E8%AF%81%E4%B9%A6%E5%BA%8F%E5%88%97%E5%8F%B7%EF%BC%9F)。 |
| **微信支付公钥** (**`推荐使用`**，公钥长期有效，管理简单)    | 用于：<br />1. 接收到APIv3接口返回内容时的验签；<br />2. 调用含敏感信息参数(如姓名、身份证号码)接口时，加密敏感信息。 | 超级管理员、技术负责人                                       | 登录微信商户平台，参考[微信支付公钥获取指南](https://pay.weixin.qq.com/doc/v3/merchant/4012153196)进行下载。 |
| **微信支付公钥id**                                           | 用于：<br />1. 接收到APIv3接口返回内容时，请求头中会携带公钥id，商户需使用对应的微信支付公钥进行验签；<br />2. 调用带有公钥加密的敏感信息参数接口时，需在请求头中传递。 | 超级管理员、技术负责人                                       | 登录微信商户平台，进入【账户中心 > 账户设置 > API安全】目录，点击【管理公钥】即可查看。 |
| **APIv3密钥**                                                | 用于：<br />1. 解密微信支付回调的加密信息；<br />2. 下载平台证书公钥时进行解密。 | 超级管理员、技术负责人                                       | 首次设置请登录微信商户平台，参考[设置APIv3密钥流程](https://pay.weixin.qq.com/doc/v3/merchant/4012072195)。设置后无法在平台查看，请妥善保管，若遗失或泄露须重新设置。 |
| **微信支付平台证书** (推荐切换成**`微信支付公钥`**，平台证书需每五年更换一次) | 作用等同于微信支付公钥，主要用于APIv3接口返回内容的验签和敏感信息加密。 | 开发人员通过调用接口下载                                     | 首次获取需通过Java命令行下载，后续可使用[微信支付平台证书下载接口](https://pay.weixin.qq.com/doc/v3/merchant/4012551764)获取。详见[平台证书简介及使用说明](https://pay.weixin.qq.com/doc/v3/merchant/4012068814#4.-%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%B9%B3%E5%8F%B0%E8%AF%81%E4%B9%A6)。 |
| **平台证书序列号**                                           | 用于：<br />1. 接收到APIv3接口返回内容时，请求头中会携带平台证书序列号，商户需使用对应的平台证书进行验签；<br />2. 调用带有平台证书加密的敏感信息参数接口时，需在请求头中传递。 | 开发人员通过调用接口获取                                     | 可通过以下三种方式查看：<br />1. 调用接口下载微信支付平台证书时，接口会返回平台证书序列号(`serial_no`)参数。<br />2. 使用openssl命令行工具查看，详见[如何查看证书序列号](https://pay.weixin.qq.com/doc/v3/merchant/4013053294)。<br />3. 使用第三方证书解析工具查看。 |

## 2. 商户API证书申请与管理

### 2.1 获取商户API证书

商户API证书是商户申请的用于证实其唯一身份的证书，由证书授权机构（CA）颁-发。证书中包含商户的商户号、公司名称、公钥等信息。

> **❗ 重要提示**：请妥善保管API证书文件，防止泄露。

1.  **登录商户平台申请证书**（需要商户号的超级管理员才能操作）
    操作路径：【微信支付商户平台 -> 账户中心 -> 账户设置 -> API安全 -> 申请API证书】

    ![img](http://file.service.qq.com/user-files/uploads/202203/0d11f37b1b40fb5e7b2df83a8870cbe5.png)
    ![img](http://file.service.qq.com/user-files/uploads/202203/744951d4308a4c5268eb930111e8e292.png)

2.  **下载并运行证书工具**
    点击下载证书工具，下载后双击 "WXCertUtil.exe" 文件，选择安装路径后，点击申请证书。
    -   windows版本 ：[点击下载](https://wx.gtimg.com/mch/files/WXCertUtil.exe)
    -   mac版本 ：[点击下载](https://wx.gtimg.com/mch/files/WXCertUtil.dmg)

    ![img](http://file.service.qq.com/user-files/uploads/202203/22079775d243eca03500640ab7acf15e.png)

3.  **在证书工具中填写商户信息**
    填写商户号和商户名称，点击下一步。

    ![img](http://file.service.qq.com/user-files/uploads/202203/2c8267ad5925cc27d42c1eac3e80d01f.png)

4.  **在证书工具中复制证书请求串**
    （若提示"请粘贴请求串到商户平台获取证书串"，请在第5点步骤检查是否已粘贴。可同时尝试手动鼠标复制粘贴的方法）

    ![img](http://file.service.qq.com/user-files/uploads/202203/24548256e02ca6a3fe043fef38f4d3c9.png)

5.  **在商户平台粘贴证书请求串**

    ![img](http://file.service.qq.com/user-files/uploads/202203/28e636311d80cc9f344df2720f4cc8f5.png)

6.  **在商户平台生成证书串**
    输入操作密码，安全验证后生成证书串。

    ![img](http://file.service.qq.com/user-files/uploads/202203/60803430fbd2c041bc3beaa826674c68.png)

7.  **在商户平台复制证书串**

    ![img](http://file.service.qq.com/user-files/uploads/202203/88dbd9181d15e8ecb09eb57539fc10c5.png)

8.  **在证书工具中粘贴证书串，完成申请**
    （若提示"证书与本地公私钥不匹配"，可能是浏览器禁用了剪切板复制功能。请在操作步骤第7点，操作时使用鼠标选中全部证书串内容（注意右边有下拉框），单击鼠标右键选择复制）

    ![img](http://file.service.qq.com/user-files/uploads/202203/c9e7d99df5ca3a8b49411855477367b9.png)
    ![img](http://file.service.qq.com/user-files/uploads/202203/0bd0da4b845f303f7785779ec039641e.png)

> **❗ 注意**：请将生成的证书文件转交给技术人员，由技术人员将证书部署到服务器上。**请务必妥善保管证书及私钥，因为私钥文件只能通过证书工具导出，若私钥丢失，则无法找回，只能作废后重新申请。**

### 2.2 常见问题

#### 2.2.1 如何查看商户API证书序列号？

登录商户平台【API安全】->【API证书】->【查看证书】，可查看商户API证书序列号。

商户API证书和微信支付平台证书均可以使用第三方的证书解析工具，查看证书内容。或者使用openssl命令行工具查看证书序列号。

```bash
$ openssl x509 -in 1900009191_20180326_cert.pem -noout -serial
serial=1DDE55AD98ED71D6EDD4A4A16996DE7B47773A8C
```

#### 2.2.2 如何获取商户API证书私钥？

商户申请商户 API 证书时，证书工具会生成商户私钥，并保存在本地证书文件夹的 `apiclient_key.pem` 文件中。私钥也可通过工具从商户的 p12 证书中导出。请妥善保管好商户私钥文件。

> **❗ 提示**：请勿将私钥文件暴露在公共场合，如上传至 GitHub 或将其写入客户端代码等。

#### 2.2.3 如何查看商户API证书使用量？

可登录商户平台 -> 【API安全】 -> 【API证书管理】页面查看API证书的昨日使用量。

![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/e32d2b820ee81a0bb9bd7606ddc94e6b.png) 

#### 2.2.4 在商户API证书即将到期时，如果旧证书未申请作废，是否可以在证书到期后直接使用新申请的证书？

API证书到期时会自动作废，过期证书无法调用v3接口，请务必在到期前完成证书更换。申请新证书不影响旧证书使用，微信支持最多3份API证书同时生效。只要不超过数量限制，无论是否作废旧证书，都可随时申请新证书。

## 3. 微信支付公钥获取

超级管理员或者安全联系人登录商户平台，进入【账户中心 -> API安全】页面，点击申请公钥后，可下载微信支付公钥。

1.  **账户中心 -> API安全**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/2e057e92813c49e270481306436303e5.png)
2.  **微信支付公钥入口页面**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/9d0aed9875878c5e479315a7c6a0a2e7.png)
3.  **微信支付公钥详情页（点击下载公钥后，可看到公钥id）**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/54ee3fe58d38702585ff62b7b0fcdeef.png)

## 4. APIv3密钥设置流程

1.  登录微信商户平台，进入【账户中心 > 账户设置 > API安全】目录，点击【APIv3密钥】。
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/21ce7614b04bef728e238c36ab85d27f.png)

2.  在弹出窗口中点击"已沟通"。
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/2325e8c30270756d8b7773b9a6d0632a.png)

3.  输入32位字符（数字及大小写字母）的API密钥，点击获取短信验证码。
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/8b9ce698ce62714572d4ed7a97555b2c.png)

4.  输入短信验证码，点击"确认"即设置成功。
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/01a17b663ed960585560011c85931895.png)

## 5. JSAPI(微信内部浏览器支付) 前置配置

### 5.1 APPID与商户号(mchid)绑定

若商户没有商户号，请参考微信支付商户入驻详细流程指引申请商户号。

**服务号或公众号APPID**: 请填写已认证的服务号或公众号APPID，需是已认证的服务号、政府或媒体类型的公众号。要求申请主体一致，且公众号需要有内容。

1. 商户如未申请公众号的appid，可参考指引注册申请：注册公众平台账号。

2. 商户如已申请公众号的appid，可登录公众平台，参考指引查看APPID账号。

> **❗ 注意**：入驻时填写的appid，系统会自动发起商户号与该APPID的授权绑定，商户参考指引确认授权绑定商户号。

![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/455621153224cf8aa3d17d511f91ac76.png)

### 5.2 申请JSAPI支付产品权限

通过【商户平台 -> 产品中心 -> JSAPI支付 -> 申请开通】，待审核(7个工作日内)通过后将开通JSAPI支付权限。

1.  **登录商户平台，点击"产品中心"**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/e92eb74f8904c0573736bbc03347a146.png)
2.  **点击"JSAPI支付"**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/3bb3f10a8aed9942e5871f3fbd7a85d8.png)
3.  **点击"申请开通"**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/a4efb87055098e185a125ae62511cc07.png)

### 5.3 核实JSAPI支付权限开通结果

商户可通过【商户平台 -> 产品中心 -> JSAPI支付】以核实JSAPI支付产品的权限开通情况：

*   **未开通页面示例**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/a4efb87055098e185a125ae62511cc07.png)
*   **开通成功页面示例**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/6c9ad3eb550ec50948a7ac3ec0501aaa.png)

### 5.4 配置JSAPI支付授权目录

**支付授权目录配置对象**：该权限只有超级管理员可配置，请商户技术人员联系超管配置。

**支付授权目录配置规则说明**：支付授权目录有两种配置形式，根据不同的配置形式，调起支付时的校验规则也会不同。

| **配置形式**       | **配置示例**                    | **校验规则**                                                 | **建议配置场景**                                             |
| :----------------- | :------------------------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 只配置到域名       | https://www.weixin.com/         | 只校验实际支付页面协议(https/http)和域名是否与配置的一致，不校验域名后面的多级目录。 | 有多个拉起支付的页面、域名相同，但多级目录不同时，建议只配置到域名，可缩减配置数量 |
| 配置到最后一级目录 | https://www.weixin.com/123/456/ | 会完整校验实际支付页面的协议(https/http)、域名、多级目录是否与配置的一致 | 支付页面数量不多、对支付页面的目录有明确要求时（例如只允许该目录下的页面进行支付），建议配置到最后一级目录 |

> **❗ 注意事项：**
>
> 1.  配置的支付授权目录，需要与实际支付页面的目录大小写一致。
> 2.  一个商户号下，最多支持配置5个支付授权目录。
> 3.  支付授权目录不支持IP格式，不能设置一个"https://192.168.1.1/" 的支付授权目录。
> 4.  支付授权目录必须以"https://"或"http://"开头，后面拼接已通过ICP备案的域名，并以"/"结尾，若需配置多级目录，配置到最后一级目录也需以"/"结尾。

**支付授权目录配置指引：**登录【商户平台—>产品中心—>开发配置】，设置后一般5分钟内生效。

1.  **登录商户平台，点击"产品中心-开发配置-支付授权目录-添加"**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/6a372fbeeaddd5ec618914140b75f126.png)
2.  **输入支付目录，点击添加按钮**
    ![img](https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/bde07c579c7043e9b78ab1a404f862a4.png)

**附：常见错误配置示例**

| **实际支付页面的url**                                 | **配置的支付授权目录**  | **配置结论**                              | **说明**                                        |
| :---------------------------------------------------- | :---------------------- | :---------------------------------------- | :---------------------------------------------- |
| https://www.weixin.com/123/456/abc.html               | https://www.Weixin.com/ | 错误                                      | 域名大小写不一致，无法拉起支付，应该配置小写"w" |
| http://www.weixin.com/                                | 错误                    | 协议不一致，无法拉起支付，应该配置https。 |                                                 |
| https://www.weixin.com/abc/                           | 错误                    | 目录不一致，无法拉起支付。                |                                                 |
| https://www.weixin.com/123/                           | 错误                    | 未配置到最后一级支付目录                  |                                                 |
| https://www.weixin.com/456/                           | 错误                    | 丢失了中间目录                            |                                                 |
| https://www.weixin.com/123 或者https://www.weixin.com | 错误                    | 配置的支付授权目录必须以"/"结尾           |                                                 |
| https://192.168.1.1/                                  | 错误                    | 配置的支付授权目录不支持IP格式            |                                                 |

> **🌐 Native(PC端网页浏览器) 支付权限获取与 JSAPI支付(微信内部浏览器) 支付同理**

---

## 参考链接

[1]: https://pay.weixin.qq.com/doc/v3/merchant/4012062524	"支付产品-JSAPI支付-产品介绍"
[2]: https://pay.weixin.qq.com/doc/v3/merchant/4013070756	"通用规则-开发须知-开发参数申请和配置-开发必要参数说明"
